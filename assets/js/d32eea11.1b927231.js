"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[343],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>c});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),d=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},l=function(e){var t=d(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=d(n),c=o,y=m["".concat(i,".").concat(c)]||m[c]||u[c]||r;return n?a.createElement(y,p(p({ref:t},l),{},{components:n})):a.createElement(y,p({ref:t},l))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,p=new Array(r);p[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,p[1]=s;for(var d=2;d<r;d++)p[d]=n[d];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2221:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>p,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var a=n(7462),o=(n(7294),n(3905));const r={title:"Update",date:"2022-09-05 06:00:00 +0000",displayed_sidebar:"aws",sidebar_position:4},p=void 0,s={unversionedId:"aws-sam/todo-app/update-todo",id:"aws-sam/todo-app/update-todo",title:"Update",description:"There are two ways in which we can update our todos. Either we can update all properties simultaneously or we can update some of the fields. By REST convention for updating all properties, we use the PUT HTTP method and for the partial update, we use the PATCH HTTP method.",source:"@site/docs/aws-sam/todo-app/update-todo.mdx",sourceDirName:"aws-sam/todo-app",slug:"/aws-sam/todo-app/update-todo",permalink:"/tutorials/aws-sam/todo-app/update-todo",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Update",date:"2022-09-05 06:00:00 +0000",displayed_sidebar:"aws",sidebar_position:4},sidebar:"aws",previous:{title:"Read",permalink:"/tutorials/aws-sam/todo-app/read-todo"},next:{title:"Delete",permalink:"/tutorials/aws-sam/todo-app/delete-todo"}},i={},d=[{value:"PUT",id:"put",level:2},{value:"Api gateway handler",id:"api-gateway-handler",level:3},{value:"Sam template configuration",id:"sam-template-configuration",level:3},{value:"PATCH",id:"patch",level:2},{value:"Api gateway handler",id:"api-gateway-handler-1",level:3},{value:"Sam template configuration",id:"sam-template-configuration-1",level:3},{value:"Test",id:"test",level:2}],l={toc:d};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"There are two ways in which we can update our todos. Either we can update all properties simultaneously or we can update some of the fields. By REST convention for updating all properties, we use the ",(0,o.kt)("inlineCode",{parentName:"p"},"PUT")," HTTP method and for the partial update, we use the ",(0,o.kt)("inlineCode",{parentName:"p"},"PATCH")," HTTP method."),(0,o.kt)("h2",{id:"put"},"PUT"),(0,o.kt)("p",null,"Let's add a function for updating all the fields of our todo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"showLineNumbers",showLineNumbers:!0},"type UpdateTodo = Omit<Todo, 'id' | 'createdAt' | 'updatedAt'>;\n\nconst putTodo = async (id: string, todo: UpdateTodo): Promise<Todo> => {\n  const item: Todo = {\n    id,\n    ...todo,\n    createdAt: timeStamp(),\n    updatedAt: timeStamp(),\n  }\n  const params: DocumentClient.PutItemInput = {\n    TableName: tableName,\n    Item: item\n  }\n  await docClient.put(params).promise();\n  return item;\n}\n")),(0,o.kt)("p",null,"If we compare our ",(0,o.kt)("inlineCode",{parentName:"p"},"putTodo")," function with ",(0,o.kt)("inlineCode",{parentName:"p"},"createTodo")," function, the only difference is here we are passing ",(0,o.kt)("strong",{parentName:"p"},"id")," as the argument and in ",(0,o.kt)("inlineCode",{parentName:"p"},"createTodo")," we are generating ",(0,o.kt)("strong",{parentName:"p"},"id")," for our todo. We are using the same ",(0,o.kt)("inlineCode",{parentName:"p"},"docClient.put")," method, on ",(0,o.kt)("strong",{parentName:"p"},"line 14"),", to update our todo as well."),(0,o.kt)("h3",{id:"api-gateway-handler"},"Api gateway handler"),(0,o.kt)("p",null,"Add an api gateway event handler ",(0,o.kt)("inlineCode",{parentName:"p"},"updateTodoHandler")," for out ",(0,o.kt)("inlineCode",{parentName:"p"},"putTodo")," fucntion."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"showLineNumbers",showLineNumbers:!0},"export const updateTodoHandler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {\n  console.log(\"createTodoHandler\", event);\n  let response: APIGatewayProxyResult;\n  try {\n    const todo: UpdateTodo = JSON.parse(event.body || '{}');\n    const updatedTodo = await putTodo(event.pathParameters?.id || '', todo);\n    response = jsonResponse(200, updatedTodo);\n  } catch (err) {\n    console.log(err);\n    response = {\n      statusCode: 500,\n      body: JSON.stringify({\n        message: 'some error happened',\n      }),\n    };\n  }\n  return response;\n};\n")),(0,o.kt)("p",null,"Here we are parsing ",(0,o.kt)("inlineCode",{parentName:"p"},"event.body")," for extracting user data on ",(0,o.kt)("strong",{parentName:"p"},"line 5")," and ",(0,o.kt)("strong",{parentName:"p"},"id")," for the todo we want to update is being extracted from ",(0,o.kt)("inlineCode",{parentName:"p"},"event.pathParameters")," on ",(0,o.kt)("strong",{parentName:"p"},"line 6"),". On the same line, we are calling our ",(0,o.kt)("inlineCode",{parentName:"p"},"putTodo")," function. Next we are updated Todo as ",(0,o.kt)("strong",{parentName:"p"},"jsonResposne"),"."),(0,o.kt)("h3",{id:"sam-template-configuration"},"Sam template configuration"),(0,o.kt)("p",null,"Add below code under ",(0,o.kt)("strong",{parentName:"p"},"Resources")," section of ",(0,o.kt)("inlineCode",{parentName:"p"},"template.yaml")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"showLineNumbers",showLineNumbers:!0},"UpdateTodoByIdFunction:\n  Type: AWS::Serverless::Function\n  Properties:\n    CodeUri: dist/\n    Handler: app.updateTodoHandler\n    Policies:\n      - DynamoDBCrudPolicy:\n          TableName: !Ref TodoTable\n    Environment:\n      Variables:\n        TODO_TABLE: !Ref TodoTable\n    Events:\n      UpdateTodo:\n        Type: Api\n        Properties:\n          Path: /todos/{id}\n          Method: PUT\n")),(0,o.kt)("p",null,"As we can see from ",(0,o.kt)("strong",{parentName:"p"},"line 12")," to ",(0,o.kt)("strong",{parentName:"p"},"line 17"),", we have added an API event with the HTTP ",(0,o.kt)("strong",{parentName:"p"},"PUT")," method and todo's ",(0,o.kt)("strong",{parentName:"p"},"id")," as path parameters."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"patch"},"PATCH"),(0,o.kt)("p",null,"Partially updating todo with ",(0,o.kt)("strong",{parentName:"p"},"DynamoDB")," is not easy. We use ",(0,o.kt)("inlineCode",{parentName:"p"},"docClient.update(params)")," method to partially update our todos.\nLets add a ",(0,o.kt)("inlineCode",{parentName:"p"},"patchTodo")," function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"showLineNumbers",showLineNumbers:!0},"type CreateTodo = Omit<Todo, 'id' | 'createdAt' | 'updatedAt'>;\ntype PatchTodo = Partial<CreateTodo>;\n\nconst patchTodo = async (id: string, todo: PatchTodo) => {\n  let UpdateExpression = 'set ';\n  let ExpressionAttributeNames: any = {};\n  let ExpressionAttributeValues: any = {};\n\n  for (const key in todo) {\n    if (key !== 'name' && key !== 'description' && key !== 'status')\n      continue;\n\n    UpdateExpression += `#${key} = :${key}, `;\n    ExpressionAttributeNames[`#${key}`] = key;\n    ExpressionAttributeValues[`:${key}`] = todo[key];\n  }\n\n  UpdateExpression += `updatedAt = :updatedAt`;\n  ExpressionAttributeValues[':updatedAt'] = timeStamp();\n  console.log({ UpdateExpression, ExpressionAttributeNames, ExpressionAttributeValues })\n  const params: DocumentClient.UpdateItemInput = {\n    TableName: tableName,\n    Key: { id },\n    UpdateExpression,\n    ExpressionAttributeNames,\n    ExpressionAttributeValues\n  }\n  return await docClient.update(params).promise();\n}\n")),(0,o.kt)("p",null,"Parameters for ",(0,o.kt)("inlineCode",{parentName:"p"},"docClient.update")," are ",(0,o.kt)("strong",{parentName:"p"},"TableName, Key, UpdateExpression, ExpressionAttributeNames & ExpressionAttributeValues"),". TableName & Key are the same as other examples. However, UpdateExpression, ExpressionAttributeNames & ExpressionAttributeValues are new for patch todo example. UpdateExpression is the one that is used to update our todo. Then based on UpdateExpression, ExpressionAttributeNames & ExpressionAttributeValues are used to set an attribute's value based on its name. Here we are setting these three parameters dynamically from ",(0,o.kt)("strong",{parentName:"p"},"line 9 to line 19"),"."),(0,o.kt)("admonition",{title:"Tip",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"More about ",(0,o.kt)("strong",{parentName:"p"},"Update an Item")," in dynamodb can be found ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_UpdateItem.html#API_UpdateItem_Examples"},"here"),".")),(0,o.kt)("h3",{id:"api-gateway-handler-1"},"Api gateway handler"),(0,o.kt)("p",null,"Now add an API gateway event handler ",(0,o.kt)("inlineCode",{parentName:"p"},"patchTodoHandler")," for our ",(0,o.kt)("inlineCode",{parentName:"p"},"patchTodo")," function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"showLineNumbers",showLineNumbers:!0},"export const patchTodoHandler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {\n  console.log(\"patchTodoHandler\", event);\n  let response: APIGatewayProxyResult;\n  try {\n    const todo: PatchTodo = JSON.parse(event.body || '{}');\n    const updateResult = await patchTodo(event.pathParameters?.id || '', todo);\n    response = jsonResponse(200, updateResult);\n  } catch (err) {\n    console.log(err);\n    response = {\n      statusCode: 500,\n      body: JSON.stringify({\n        message: 'some error happened',\n      }),\n    };\n  }\n  return response;\n};\n")),(0,o.kt)("p",null,"This handler is almost similar in functionality except we are calling ",(0,o.kt)("inlineCode",{parentName:"p"},"patchTodo")," function on ",(0,o.kt)("strong",{parentName:"p"},"line 6"),"."),(0,o.kt)("h3",{id:"sam-template-configuration-1"},"Sam template configuration"),(0,o.kt)("p",null,"Add below lines of code in ",(0,o.kt)("inlineCode",{parentName:"p"},"templat.yaml")," file under ",(0,o.kt)("strong",{parentName:"p"},"Resources")," section."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"showLineNumbers",showLineNumbers:!0},"PatchTodoByIdFunction:\n  Type: AWS::Serverless::Function\n  Properties:\n    CodeUri: dist/\n    Handler: app.patchTodoHandler\n    Policies:\n      - DynamoDBCrudPolicy:\n          TableName: !Ref TodoTable\n    Environment:\n      Variables:\n        TODO_TABLE: !Ref TodoTable\n    Events:\n      UpdateTodo:\n        Type: Api\n        Properties:\n          Path: /todos/{id}\n          Method: PATCH\n")),(0,o.kt)("p",null,"Here we are adding an api event with ",(0,o.kt)("inlineCode",{parentName:"p"},"PATCH")," http method."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"test"},"Test"),(0,o.kt)("p",null,"Build and deploy your application. You will see our lambda functions are being created. After the deployment is completed, you can update any todos either completely or partially and check if the application is working as expected or not."))}u.isMDXComponent=!0}}]);